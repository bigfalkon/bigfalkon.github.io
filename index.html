<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karakter Galerisi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #2d3748; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6a7280; cursor: pointer; }

        .modal-backdrop {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .enlarged-image-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; cursor: zoom-out;
        }
        .enlarged-image {
            max-width: 90%; max-height: 90%;
            object-fit: contain; border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        h1.main-title {
            font-family: 'Cinzel Decorative', cursive;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        #modal-character-name, #modal-fusion-name {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .font-fusion {
            font-family: 'Uncial Antiqua', cursive;
            text-shadow: 1px 1px 3px rgba(167, 139, 250, 0.4);
        }
        
        .zoom-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .zoom-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            line-height: 1;
            width: 36px;
            height: 36px;
        }

        .glow-purple {
            box-shadow: 
                0 0 8px rgba(167, 139, 250, 0.6),
                0 0 20px rgba(167, 139, 250, 0.4),
                0 0 40px rgba(167, 139, 250, 0.2);
        }
        
        @keyframes text-pulse-glow {
            0% { filter: drop-shadow(0 0 5px rgba(167, 139, 250, 0.8)); }
            50% { filter: drop-shadow(0 0 12px rgba(167, 139, 250, 1.0)) drop-shadow(0 0 20px rgba(167, 139, 250, 0.6)); }
            100% { filter: drop-shadow(0 0 5px rgba(167, 139, 250, 0.8)); }
        }

        .glow-text-purple-animated {
            animation: text-pulse-glow 1.5s infinite alternate;
        }

        .fusion-modal-background-glow {
            box-shadow: 
                inset 0 0 20px rgba(167, 139, 250, 0.3),
                0 0 25px rgba(167, 139, 250, 0.5),
                0 0 50px rgba(167, 139, 250, 0.2);
            background: radial-gradient(circle at center, rgba(167, 139, 250, 0.1) 0%, rgba(94, 234, 212, 0.05) 50%, rgba(68, 76, 94, 0) 100%), 
                        linear-gradient(135deg, #5a2a7a 0%, #3a1a4a 100%);
        }

        #character-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(var(--grid-min-card-width), var(--grid-max-card-width)));
            justify-content: center;
        }

        .character-card-image {
            width: 100%;
            height: auto;
            max-height: 100%;
            object-fit: contain;
        }

        /* DEĞİŞİKLİK: İsim kısaltma sorunu için max-width eklendi */
        .character-name-ellipsis {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%; /* Sığmayan isimlerin taşmasını engeller */
        }
        
        .control-group-bg {
            background-color: #3b82f6;
        }
        .control-group-bg.hover-effect:hover {
            background-color: #2563eb;
        }

        #fitToScreenToggleBtn {
            font-size: 1.5rem;
            line-height: 1;
        }

        #fitToScreenToggleBtn.active {
            background-color: #10b981;
            color: white;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4);
        }
        #fitToScreenToggleBtn:not(.active) {
            background-color: #3b82f6;
            color: white;
        }

        .modal-nav-button {
            @apply px-4 py-2 rounded-full text-lg font-semibold transition-all duration-300 ease-in-out;
            @apply bg-gray-600 text-gray-200 shadow-md hover:bg-gray-500;
        }
        .modal-nav-button:disabled {
            @apply opacity-50 cursor-not-allowed;
        }

        .modal-nav-text {
            @apply text-gray-300 text-sm md:text-md whitespace-nowrap overflow-hidden text-overflow-ellipsis max-w-[120px] md:max-w-[180px];
        }

    </style>
</head>
<body class="p-4 md:p-8">
    <div id="app" class="max-w-7xl mx-auto bg-gray-800 rounded-xl shadow-lg p-6 md:p-8 relative">
        
        <div class="flex justify-between items-center mb-8 flex-wrap">
            <h1 class="text-4xl font-extrabold text-center text-indigo-400 main-title mb-4 sm:mb-0">Karakter Galerisi</h1>
        </div>

        <div class="flex flex-wrap justify-center space-x-2 md:space-x-4 mb-8">
            <button id="show-1-star-btn" class="px-3 py-2 md:px-5 md:py-2 rounded-full text-sm md:text-lg font-semibold transition-all duration-300 ease-in-out bg-gray-700 text-gray-200 shadow-md hover:bg-gray-600 mb-2">
                <span class="text-orange-400">★</span>
            </button>
            <button id="show-2-star-btn" class="px-3 py-2 md:px-5 md:py-2 rounded-full text-sm md:text-lg font-semibold transition-all duration-300 ease-in-out bg-gray-700 text-gray-200 shadow-md hover:bg-gray-600 mb-2">
                <span class="text-gray-400">★★</span>
            </button>
            <button id="show-3-star-btn" class="px-3 py-2 md:px-5 md:py-2 rounded-full text-sm md:text-lg font-semibold transition-all duration-300 ease-in-out bg-gray-700 text-gray-200 shadow-md hover:bg-gray-600 mb-2">
                <span class="text-yellow-400">★★★</span>
            </button>
            <button id="show-fusion-btn" class="px-3 py-2 md:px-5 md:py-2 rounded-full text-sm md:text-lg font-semibold transition-all duration-300 ease-in-out bg-gray-700 text-gray-200 shadow-md hover:bg-gray-600 mb-2">
                <span class="text-purple-400">★★★★</span>
            </button>
            <button id="show-all-btn" class="px-3 py-2 md:px-5 md:py-2 rounded-full text-sm md:text-lg font-semibold transition-all duration-300 ease-in-out bg-indigo-600 text-white shadow-md hover:bg-indigo-700 mb-2">
                Tüm Karakterler
            </button>

            <div id="image-size-controls" class="flex items-center space-x-2 px-1 rounded-full shadow-md mb-2 control-group-bg"> 
                <button id="zoom-out-btn" class="zoom-btn rounded-full bg-blue-600 hover:bg-blue-700 text-white font-bold transition-all" aria-label="Galeri Kartlarını Küçült">
                    &#x2212; 
                </button>
                <span id="current-size-label" class="text-sm font-semibold w-8 text-center text-white">4</span> 
                <button id="zoom-in-btn" class="zoom-btn rounded-full bg-blue-600 hover:bg-blue-700 text-white font-bold transition-all" aria-label="Galeri Kartlarını Büyüt">
                    &#x2B; 
                </button>
            </div>

            <button id="fitToScreenToggleBtn" class="rounded-full w-10 h-10 shadow-md hover-effect transition duration-300 ease-in-out mb-2" aria-label="Daha Fazla Karakter Göster / Normal Mod">
                &#9638; 
            </button>
            
            <div id="columns-slider-container" class="mt-2 w-full hidden"> 
                <label for="column-count-slider" class="block text-gray-200 font-medium mb-1 text-center text-sm">Yan Yana Sığacak Kart: <span id="column-count-value">4</span></label>
                <input type="range" id="column-count-slider" min="2" max="6" value="4" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
            </div>
            
        </div>

        <div id="character-grid">
            </div>

        <div id="character-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4 z-50 overflow-y-auto" onclick="closeCharacterModal()">
           <div class="bg-gray-700 rounded-xl shadow-2xl p-6 w-full h-full transform transition-all duration-300 ease-out scale-95 opacity-0 overflow-y-auto flex flex-col" id="character-modal-content" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6 flex-shrink-0">
                    <h2 id="modal-character-name" class="text-3xl font-bold text-indigo-400 text-center flex-grow mx-2"></h2>
                    <button class="text-gray-400 hover:text-gray-200 text-4xl font-light" onclick="closeCharacterModal()" aria-label="Karakter Detaylarını Kapat">&times;</button>
                </div>
                
                <div class="flex-grow overflow-y-auto pr-2">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="flex flex-col col-span-full">
                            <h3 class="text-2xl font-semibold text-indigo-400 border-b pb-2 mb-2">Açıklama:</h3>
                            <p id="modal-character-description" class="text-gray-200 mb-4"></p>
                        </div>
                        <div id="modal-evolutions" class="col-span-full flex flex-wrap justify-center gap-4 mb-6"></div>
                    </div>
                    <div id="modal-fusions" class="mt-6">
                        <h3 class="text-2xl font-semibold text-indigo-400 border-b pb-2 mb-4">Katıldığı Füzyonlar:</h3>
                        <div id="fusion-list" class="grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-600 flex-shrink-0">
                    <div class="flex items-center space-x-2">
                        <button id="prev-char-btn" class="modal-nav-button text-xl" aria-label="Önceki Karakter">&#8592;</button>
                        <span id="prev-char-name" class="modal-nav-text"></span>
                    </div>
                    <div class="flex items-center space-x-2 justify-end">
                        <span id="next-char-name" class="modal-nav-text text-right"></span>
                        <button id="next-char-btn" class="modal-nav-button text-xl" aria-label="Sonraki Karakter">&#8594;</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="fusion-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center p-4 z-50 overflow-y-auto" onclick="closeFusionModal()">
            <div class="bg-gray-700 rounded-xl shadow-2xl p-6 w-full h-full transform transition-all duration-300 ease-out scale-95 opacity-0 overflow-y-auto flex flex-col" id="fusion-modal-content" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6 flex-shrink-0">
                    <h2 id="modal-fusion-name" class="text-3xl font-bold text-indigo-400 text-center flex-grow mx-2"></h2>
                    <button class="text-gray-400 hover:text-gray-200 text-4xl font-light" onclick="closeFusionModal()" aria-label="Füzyon Detaylarını Kapat">&times;</button>
                </div>
                
                <div class="flex-grow overflow-y-auto pr-2">
                    <h3 class="text-2xl font-semibold text-indigo-400 border-b pb-2 mb-2">Açıklama:</h3>
                    <p id="modal-fusion-description" class="text-gray-200 mb-6"></p>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-6 mb-6">
                        <div class="flex flex-col items-center text-center cursor-pointer p-2 rounded-lg hover:bg-gray-600 transition duration-200" data-character-id="" onclick="closeFusionModal(); openCharacterModal(this.dataset.characterId);">
                            <img id="modal-fusion-left-char-image" src="" alt="Sol Karakter" class="object-contain rounded-lg border-4 border-indigo-500 shadow-md">
                            <p id="modal-fusion-left-char-name" class="mt-2 text-lg font-semibold text-gray-200"></p>
                            <p class="text-lg font-medium text-gray-200" id="modal-fusion-left-char-star"></p>
                        </div>
                        <div class="flex flex-col items-center">
                            <img id="modal-fusion-image" src="" alt="Füzyon Resmi" class="w-full h-auto object-contain rounded-lg shadow-md cursor-zoom-in" onclick="enlargeImage(this.src)">
                            <p id="modal-fusion-star" class="text-xl font-semibold text-gray-200 mt-2"></p>
                        </div>
                        <div class="flex flex-col items-center text-center cursor-pointer p-2 rounded-lg hover:bg-gray-600 transition duration-200" data-character-id="" onclick="closeFusionModal(); openCharacterModal(this.dataset.characterId);">
                            <img id="modal-fusion-right-char-image" src="" alt="Sağ Karakter" class="object-contain rounded-lg border-4 border-indigo-500 shadow-md">
                            <p id="modal-fusion-right-char-name" class="mt-2 text-lg font-semibold text-gray-200"></p>
                            <p class="text-lg font-medium text-gray-200" id="modal-fusion-right-char-star"></p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-600 flex-shrink-0">
                    <div class="flex items-center space-x-2">
                        <button id="prev-fusion-btn" class="modal-nav-button text-xl" aria-label="Önceki Füzyon">&#8592;</button>
                        <span id="prev-fusion-name" class="modal-nav-text"></span>
                    </div>
                    <div class="flex items-center space-x-2 justify-end">
                        <span id="next-fusion-name" class="modal-nav-text text-right"></span>
                        <button id="next-fusion-btn" class="modal-nav-button text-xl" aria-label="Sonraki Füzyon">&#8594;</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="enlarged-image-overlay" class="enlarged-image-container hidden" onclick="closeEnlargedImage()">
            <button class="absolute top-4 right-4 text-gray-200 hover:text-white text-5xl font-light z-10" onclick="closeEnlargedImage(event)" aria-label="Resmi Kapat">&times;</button>
            <img id="enlarged-image" src="" alt="Büyük Resim" class="enlarged-image">
        </div>

    </div>

    <script>
        const FUSION_BACKGROUND_COLOR = '#5a2a7a'; 
        const FUSION_STAR_COLOR_CLASS = 'text-purple-400'; 
        const THREE_STAR_COLOR_CLASS = 'text-yellow-400'; 

        const characters = [
            // SADECE TEMEL KARAKTERLER (IDleri artık sayısız)
            { id: 'buyucu', name: 'Büyücü', description: 'Güçlü büyüleriyle öne çıkan bu sarışın büyücü, zarif ve cüretkar kıyafetleriyle dikkat çekerken, mistik pembe büyülerle düşmanlarına korku salar.', star: 1, imageUrl: 'https://i.ibb.co/WW3DSjgT/b-y-c-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/xK0j21XT/b-y-c-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/rKjQfVWR/b-y-c-3.jpg' }] },
            { id: 'rahibe', name: 'Rahibe', description: 'Kutsal iyileştirme güçlerine sahip bu kahverengi saçlı rahibe, hem nezaketi hem de güçlü duruşuyla ibadet ettiği mabetlerde ilahi ışık saçar.', star: 1, imageUrl: 'https://i.ibb.co/PZg5t9VL/rahibe1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/FLxK9MVn/rahibe2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/FLtj64kw/rahibe3.jpg' }] },
            { id: 'dansoz', name: 'Dansöz', description: 'Esnekliği ve cazibesiyle büyüleyen bu siyahi dansçı, altın aksesuarlarla süslü şeffaf kıyafetleriyle sahneyi aydınlatırken izleyicileri kendine hayran bırakır.', star: 1, imageUrl: 'https://i.ibb.co/vxC47N0c/dans-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/qMKfjQ6H/dans-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/8gwWTnW1/dans-3.jpg' }] },
            { id: 'falci', name: 'Falcı', description: 'Gizemli güçlere sahip bu koyu tenli falcı, mor saçları ve parlayan kristal topuyla geleceğe dair sırlar fısıldar.', star: 1, imageUrl: 'https://i.ibb.co/ynpvZp1L/falc-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/ZRCkv6Sw/falc-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/1YSLR43x/falc-3.jpg' }] },
            { id: 'korsan', name: 'Korsan', description: 'Denizlerin vahşi ruhunu taşıyan bu kızıl saçlı kadın korsan, tehlikeli maceralara atılırken gözü kara ve baştan çıkarıcı bir tavır sergiler.', star: 1, imageUrl: 'https://i.ibb.co/CpVChGPv/korsan1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/SwLyG1tQ/korsan2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/Q3QCJ7fP/korsan3.jpg' }] },
            { id: 'savasci', name: 'Savaşçı', description: 'Sıcak ten rengine sahip bu kahverengi saçlı savaşçı, atletik ve gösterişli vücudunu vurgulayan zırhıyla meydan okurcasına durur.', star: 1, imageUrl: 'https://i.ibb.co/GQ58h73N/sava-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/tP3dHwqh/sava-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/YF2mpmks/sava-3.jpg' }] },
            { id: 'okcu', name: 'Okçu', description: 'Hafif zeytin tenli ve kestane rengi saçlı bu genç okçu, keskin nişancılığı ve çekici duruşuyla hedeflerini gözüne kestirir.', star: 1, imageUrl: 'https://i.ibb.co/7t5Pgxr0/ok-u1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/Kcx424sg/ok-u2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/tTvN7j1H/ok-u3.jpg' }] },
            { id: 'ninja', name: 'Ninja', description: 'Gizemli ve ölümcül Japon ninjası, zarif hareketleri ve baştan çıkarıcı duruşuyla gölgelerin arasından süzülür.', star: 1, imageUrl: 'https://i.ibb.co/TJ4z4RP/ninja1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/SDrwNJrh/ninja2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/YBDCkTL9/ninja3.jpg' }] },
            { id: 'izci', name: 'İzci', description: 'Gözlükleriyle bilinen, zeki ve maceraperest bu kızıl saçlı izci, hem pratik bilgisi hem de çekici duruşuyla keşiflere liderlik eder.', star: 1, imageUrl: 'https://i.ibb.co/4wvy0p7H/izci1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/B57pqBm4/izci2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/Xr6wnQjC/izci3.jpg' }] },
            { id: 'hayalet', name: 'Hayalet', description: 'Esrarengiz ve yarı saydam bu kadın hayalet, melankolik duruşu ve etrafındaki sisli aura ile huzursuz bir güzellik taşır.', star: 1, imageUrl: 'https://i.ibb.co/rfKR25Vm/hayalet1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/21VC2dPt/hayalet2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/YFR2Rw0K/hayalet3.jpg' }] },
            { id: 'atesbuyucusu', name: 'Ateş Büyücüsü', description: 'Ateşten saçlara ve parlayan kızıl gözlere sahip bu büyücü, alevleri ustaca kontrol ederken özgüvenli ve buyurgan bir tavır sergiler.', star: 1, imageUrl: 'https://i.ibb.co/1GBHw5gc/ate-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/xtVWHqq4/ate-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/8gV8fSrh/ate-3.jpg' }] },
            { id: 'buzbuyucusu', name: 'Buz Büyücüsü', description: 'Platin beyazı saçlı bu utangaç buz büyücüsü, nazik ve mesafeli tavrıyla büyüleyici aurora renkleriyle dolu buz büyüleri yapar.', star: 1, imageUrl: 'https://i.ibb.co/M4WT53b/buz1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/yzqR3jM/buz2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/zW97htBN/buz3.jpg' }] },
            { id: 'silahsor', name: 'Silahşör', description: 'Cesur ve zeki bu silahşör, şık üniforması ve keskin bakışlarıyla her daim maceraya hazır, zarif kılıcı ve tabancasıyla adaletin peşinde.', star: 1, imageUrl: 'https://i.ibb.co/ZpDDqkPP/indir-2.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/5WcQs9Nq/indir-3.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/SXFr056v/indir-4.jpg' }] },
            { id: 'cazibe', name: 'Cazibe', description: 'Ölümlülerin arzularından doğan Cazibe, fısıltıyla aklını çeler ve seni kendi tatlı günahlarının esiri yapar.', star: 1, imageUrl: 'https://i.ibb.co/yBQBGL5Y/cazibe1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/k2hXkSKV/cazibe2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/xSxMwnz5/cazibe3.jpg' }] },
            { id: 'ormanruhu', name: 'Orman Ruhu', description: 'Masum bir orman fidanı olarak doğdu, zamanla hem hayat veren hem de can alan, doğanın vahşi kraliçesine dönüştü.', star: 1, imageUrl: 'https://i.ibb.co/RkZfXFWX/do-a.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/XZxytsM4/do-a2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/8DSbGRzR/do-a3.jpg' }] },
            { id: 'sahinci', name: 'Şahinci', description: 'Gökyüzünün yalnız avcısı, doğayla bütünleşmiş, keskin gözleri ve sadık şahiniyle özgürlüğün sembolü.', star: 1, imageUrl: 'https://i.ibb.co/pBSb9vVZ/ahin1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/JjmhzkBM/ahin2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/Vptx2S9p/ahin3.jpg' }] },
            { id: 'illuzyonist', name: 'İllüzyonist', description: 'Gölgelerin sırlarını bilen, illüzyonlarla gerçeği büken, gizemli ve güçlü bir gölge rahibesi.', star: 1, imageUrl: 'https://i.ibb.co/C5Lr8DDV/ill-zyon1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/fVtZpN8s/ill-zyon2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/VYSz0PYK/ill-zyon3.jpg' }] },
            { id: 'dervis', name: 'Derviş', description: 'Çölün sessiz fırtınası, kadim kumların ve rüzgarların dansını ölümcül bir sanata dönüştüren, melankolik ve kararlı bir savaşçı.', star: 1, imageUrl: 'https://i.ibb.co/dsZRZzpt/dervi-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/zT3tm8sz/dervi-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/qMv1jB15/dervi-3.jpg' }] },
            { id: 'prenses', name: 'Prenses', description: 'Sarayının altın kafesine hapsolmuş, kibirli bir Fae prensesi, sıkıcı soyluluk kurallarından daha fazlasını arzular. İsyanı, ipek elbisesini parçalamasıyla başlar ve onu, kendi kurallarını kendi koyduğu kaotik kutlamaların ve vahşi özgürlüğün kraliçesi yapar.', star: 1, imageUrl: 'https://i.ibb.co/cK8m4bMJ/peri1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/ZpgB5cjG/peri2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/jZbTFb9v/peri3.jpg' }] },
            { id: 'simyaci', name: 'Simyacı', description: 'Kimyasal sırların ve elementlerin bilgini, iksirler ve dönüşümlerle hem şifa hem de yıkım yaratabilen, zeki ve deneysel bir bilim insanı.', star: 1, imageUrl: 'https://i.ibb.co/0pg4Vrh0/simyac-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/N65VzdkH/simyac-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/9387YgZf/simyac-3.jpg' }] },{ id: 'kedikadin', name: 'Kedi Kadın', description: 'Ormanların en derinlerinde gizlenen, hem av hem de avcı olan bu figür, kedi çevikliği ve yırtıcı içgüdüleriyle doğanın dengesini korur.', star: 1, imageUrl: 'https://i.ibb.co/zWTLhSR7/kedi1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/qYxVScfn/kedi2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/LdYJX6Hd/kedi3.jpg' }] },
                { id: 'kuskadin', name: 'Kuş Kadın', description: 'Gökyüzünün engin maviliklerinde özgürlüğünü bulan, rüzgarlarla sohbet eden bu hava varlığı, kanatlarını sadece uçmak için değil, aynı zamanda insan ruhuna ilham vermek için kullanır. Her süzülüşünde, özgürlüğün ve hafifliğin bir fısıltısını taşır.', star: 1, imageUrl: 'https://i.ibb.co/RGWyqqQr/ku-1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/jkhsNMbx/ku-2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/0j0d4xNb/ku-3.jpg' }] },
                { id: 'vampir', name: 'Vampir', description: 'Sıcak ten rengine sahip bu kahverengi saçlı savaşçı, atletik ve gösterişli vücudunu vurgulayan zırhıyla meydan okurcasına durur.', star: 1, imageUrl: 'https://i.ibb.co/6JHHhJw6/vampir1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/tP8fxr6C/vampir2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/RMh7SNB/vampir3.jpg' }] },{ id: 'paraliasker', name: 'Paralı Asker', description: 'Savaşa korkak bir acemi olarak başladı, döktüğü kan ve kazandığı yaralarla çelikleşerek korkusuz bir paralı asker liderine dönüştü. Onun gücü büyüde değil, sarsılmaz iradesinde ve bükülmez kılıcındadır.', star: 1, imageUrl: 'https://i.ibb.co/0g5P99T/asker1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/23RBCVzG/asker2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/8QkMRtg/asker3.jpg' }] },
            { id: 'mekanik', name: 'Mekanik', description: 'Dişlilerin ve buharın arasında büyümüş, dehası parmaklarının ucundaki yağ lekelerinde gizli olan bir teknisyendir. Her yeni icadıyla, makineye olan tutkusu onu biraz daha metal, biraz daha az insan yapar.', star: 1, imageUrl: 'https://i.ibb.co/d0wmWp3M/mekanik1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/nsM8qXrZ/mekanik2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/jkCct99V/mekanik3.jpg' }] },
            { id: 'saman', name: 'Şaman', description: 'Ruhlar aleminin fısıltılarını dinleyen ve doğanın kadim gücüne hükmeden bir arabulucudur. Yolculuğu onu sakin bir bilgelikten, sayısız ruhu yöneten huşu uyandıran bir güce taşır.', star: 1, imageUrl: 'https://i.ibb.co/jZQjdxGr/aman1.jpg', 
                evolutions: [{ star: 2, imageUrl: 'https://i.ibb.co/6cw94xmS/aman2.jpg' }, { star: 3, imageUrl: 'https://i.ibb.co/Z6qgBHf6/aman3.jpg' }] },
            
            // FÜZYON KARAKTERLERİ
            { id: 'cadı', name: 'Cadı', description: 'Hem karanlığın mistik bilgeliğini hem de kutsal ışığın gücünü barındıran bu melez büyü-rahibe, her adımıyla kadim bir dengeyi ve sınırsız bir potansiyeli temsil eder.', star: 4, imageUrl: 'https://i.ibb.co/HfmJN43L/kaos-cad-s.jpg', isFusion: true, fusionPartners: ['buyucu', 'rahibe'] },
            { id: 'kozmik-dansci', name: 'Kozmik Dansçı', description: 'Yıldızların ritmiyle evreni adımlayan bu göksel dansçı, kehanetin fısıltılarıyla dans ederken kozmik enerjiyi zarafetle şekillendirir.', star: 4, imageUrl: 'https://i.ibb.co/whpyGMMQ/kozmik-yolcu.jpg', isFusion: true, fusionPartners: ['dansoz', 'falci'] },
            { id: 'siren', name: 'Batık Hazine', description: 'Derin denizlerin baştan çıkarıcı şarkısıyla korsanların cüretkar ruhunu birleştiren bu siren, dalgalardan yükselerek hem cazibeyi hem de tehlikeyi çağırır.', star: 4, imageUrl: 'https://i.ibb.co/Pvg53HMY/merge-video-1753634899103.gif', isFusion: true, fusionPartners: ['dansoz', 'korsan'] },
            { id: 'valkur', name: 'Valkür', description: 'Göksel bir savaş narasıyla ilahi gücü harmanlayan bu Valkür, kutsal bir gazapla savaş meydanına inen, hem koruyucu hem de yıkıcı bir melektir.', star: 4, imageUrl: 'https://i.ibb.co/cXbXcnqf/valk-r.jpg', isFusion: true, fusionPartners: ['rahibe', 'savasci'] },
            { id: 'kahin', name: 'Kader Örücü', description: 'Gölgelerin bilgeliğiyle geleceğin sırlarını çözene bu ninja-falcı, kadim kehanetleri ölümcül bir zarafetle birleştirerek kaderin iplerini elinde tutar.', star: 4, imageUrl: 'https://i.ibb.co/DfJFYb15/1753596921039.gif', isFusion: true, fusionPartners: ['falci', 'ninja'] },
            { id: 'avci', name: 'Avcı', description: 'Büyülü oklarla hedefini avlayan bu karanlık ormanların kızı, hem avcının keskin içgüdüsüne hem de büyücünün kadim kudretine sahiptir.', star: 4, imageUrl: 'https://i.ibb.co/YTT1Y36M/mistik-avc.jpg', isFusion: true, fusionPartners: ['buyucu', 'okcu'] },
            { id: 'nisanci', name: 'Filo Avcısı', description: 'Fırtınalı denizlerin ve isabetli okların ustası olan bu deniz gezgini, azgın dalgaların üzerinde ölümcül bir hassasiyetle hedeflerini bulur.', star: 4, imageUrl: 'https://i.ibb.co/MDMFcCQq/indir-46.jpg', isFusion: true, fusionPartners: ['korsan', 'okcu'] },
            { id: 'suvari', name: 'Süvari', description: 'Savaşı ve keşfi tek bir ruhta birleştiren bu süvari, kudretli bineğiyle efsaneler yazarken, bilgi ve gücün çarpıcı bir sembolüdür.', star: 4, imageUrl: 'https://i.ibb.co/fY8N7sqL/s-vari.jpg', isFusion: true, fusionPartners: ['izci', 'savasci'] },
            { id: 'kadim-buyucu', name: 'Kadim Büyücü', description: 'Elemental güçlerin tanrıçası olan bu kadim varlık, hem yakan ateşi hem de dondurucu buzu bedeninde barındırarak evrenin kendisiyle yankılanır.', star: 4, imageUrl: 'https://i.ibb.co/vgNxdtD/kadim.jpg', isFusion: true, fusionPartners: ['atesbuyucusu', 'buzbuyucusu'] },
            { id: 'cehennem-dalgasi', name: 'Cehennem Dalgası', 'description': 'Alevlerin ve okyanusların hükümdarı olan bu korsan büyücü, lav denizlerinde yelken açarken cehennemi gücü ve dizginlenemez özgürlüğü temsil eder.', star: 4, imageUrl: 'https://i.ibb.co/r2F8Wcw6/Ate-Efektli-Karakter-Videosu.gif', isFusion: true, fusionPartners: ['atesbuyucusu', 'korsan'] },
            { id: 'ruh-cagiran', name: 'Ruh Çağıran', description: 'Perde aralığını aşarak ruhlarla konuşan bu psişik varlık, öteki dünyanın fısıltılarını taşıyan ve fısıltılarla dünyalar arasında köprü kuran kadim bir medyumdur.', star: 4, imageUrl: 'https://i.ibb.co/hxHC8XBm/ruh.jpg', isFusion: true, fusionPartners: ['hayalet', 'falci'] },
            { id: 'ruh-avcisi', name: 'Ruh Avcısı', description: 'Savaşın kaosunda ruhları avlayan bu melez, yıkımın ortasında hem ilahi bir güzellik hem de doyumsuz bir kudret sergiler.', star: 4, imageUrl: 'https://i.ibb.co/MDbNYwmV/indir-6.jpg', isFusion: true, fusionPartners: ['silahsor', 'hayalet'] },
            { id: 'keskin-nisanci', name: 'Keskin Nişancı', description: 'Hedefini kusursuz bir hassasiyetle vuran bu keskin nişancı, savaşçının gücünü ve nişancının zarafetini birleştirerek her atışında ölümcül bir cazibe saçar.', star: 4, imageUrl: 'https://i.ibb.co/fzGxn263/indir-9.jpg', isFusion: true, fusionPartners: ['silahsor', 'okcu'] },
            { id: 'olumsuz-muhafiz', name: 'Ölümsüz Muhafız', description: 'Bir savaşçının ölmeyi reddeden ruhu, unuttuğu bir yemine sadakatle bağlı kalarak ebedi bir mezarın başında nöbet tutar. O, ne yaşayanların ne de ölülerin dünyasına aittir.', star: 4, imageUrl: 'https://i.ibb.co/F4Z1pMBv/l-ms-z.jpg', isFusion: true, fusionPartners: ['savasci', 'hayalet'] },
            { id: 'donmus-kalp', name: 'Donmuş Kalp', description: 'Bir zamanlar en sıcak tutkuyla yanan kalbi, şimdi dokunuşuyla her şeyi donduran bir buz kütlesidir. Sana unuttuğu sıcaklığı vaat eder, ancak öpücüğü ruhunu ebedi bir kışa hapseder.', star: 4, imageUrl: 'https://i.ibb.co/p6x1XVF6/donuk-kalp.jpg', isFusion: true, fusionPartners: ['cazibe', 'buzbuyucusu'] },
            { id: 'yasak-meyve', name: 'Yasak Meyve', description: 'Seni kendi cennet bahçesine davet eder, ancak o bahçedeki en güzel çiçekler en zehirli olanlardır. Onun sunduğu yasak meyveyi tadan, ruhunu sonsuza dek kaybeder.', star: 4, imageUrl: 'https://i.ibb.co/C5YtZyzm/yasak-elma.jpg', isFusion: true, fusionPartners: ['cazibe', 'ormanruhu'] },
            { id: 'serap-kilici', name: 'Serap Kılıcı', description: 'Çölün ortasında parlayan bir serap gibi, o hem bir yanılsama hem de ölümcül bir gerçektir. Rakiplerini zihinlerini bulandıran gölge oyunlarıyla tuzağa düşürür ve tam nerede olduğunu anladıklarında, dervişin pala dansı çoktan başlamıştır.', star: 4, imageUrl: 'https://i.ibb.co/BK3rG036/serap.jpg', isFusion: true, fusionPartners: ['illuzyonist', 'dervis'] },
            { id: 'hayalet-kanat', name: 'Hayalet Kanat', description: 'Gökyüzünde süzülen bir gölgeden farksız olan Hayalet Kanat, hem avının adımlarını hem de ruhunun fısıltılarını duyar. O, ne zaman gerçek bir şahin ne zaman ölümcül bir ilüzyon olduğu asla bilinmeyen, gökyüzünün en tehlikeli sırrıdır.', star: 4, imageUrl: 'https://i.ibb.co/fdnf9Hg9/g-lge.jpg', isFusion: true, fusionPartners: ['illuzyonist', 'sahinci'] },
            { id: 'asi-kralice', name: 'Asi Kraliçe', description: 'Altın kafesini parçalayan bir prensesin isyanı ile bir savaşçının sarsılmaz gücü onda birleşti.', star: 4, imageUrl: 'https://i.ibb.co/NgWyfWv2/krali-e.jpg', isFusion: true, fusionPartners: ['savasci', 'prenses'] },
            { id: 'sehvet-perisi', name: 'Şehvet Perisi', description: 'Bir Fae prensesinin masumiyetini bir Succubusun günahkar vaatleriyle birleştiren Şehvet Perisi, dokunuşuyla en saf kalpleri bile yoldan çıkarır.', star: 4, imageUrl: 'https://i.ibb.co/yB005D9y/sehvet.jpg', isFusion: true, fusionPartners: ['cazibe', 'prenses'] },
            { id: 'ask-iksiri', name: 'Aşk İksiri', description: 'Kimyasal bilgiyle baştan çıkarıcılığı birleştiren, arzu ve tehlikenin vücut bulmuş hali, yasak zevklerin kraliçesi.', star: 4, imageUrl: 'https://i.ibb.co/5hFJqdHR/indir-1-8.jpg', isFusion: true, fusionPartners: ['simyaci', 'cazibe'] },
            { id: 'zehir-tuccari', name: 'Zehir Tüccarı', description: 'Gölgelerde gizlenen, hem zehirlerini hem de ölümcül cazibesini ustaca kullanan, karanlık pazarın sessiz ve tehlikeli kraliçesi.', star: 4, imageUrl: 'https://i.ibb.co/ZRSbLd0r/zehir.jpg', isFusion: true, fusionPartners: ['ninja', 'simyaci'] },
            { id: 'golge-buyucu', name: 'Gölge Büyücü', description: 'Kadim büyüleri gölgelerle harmanlayan, illüzyonlar ve sessiz suikast yetenekleriyle düşmanlarını avlayan, gizemli ve ölümcül bir büyü ustası.', star: 4, imageUrl: 'https://i.ibb.co/vCF3QhhG/kara.jpg', isFusion: true, fusionPartners: ['buyucu', 'ninja'] },
            { id: 'golge-panteri', name: 'Gölge Panteri', description: 'İlkel içgüdüleriyle gölgelerin sanatını birleştiren bu nihai avcı, ormanların derinliklerinden yükselir. Her pusuya yatışında hem yırtıcı bir Panterin vahşiliğini hem de bir Ninjanın sessiz ölümcüllüğünü yansıtır.', star: 4, imageUrl: 'https://i.ibb.co/nq7PjzvP/golgepanteri.jpg', isFusion: true, fusionPartners: ['kedikadin', 'ninja'] },
            { id: 'olum-valsi', name: 'Ölüm Valsi', description: 'Çölün ruhuyla ritmin gücünü birleştiren, her adımıyla hem kumları hem de ruhları dans ettiren ölümcül bir sanatçı. O sadece bir dansçı değil, aynı zamanda hareketleriyle yaşam ve ölümü dengeleyen, ebedi bir valstir.', star: 4, imageUrl: 'https://i.ibb.co/W4rh6MnB/l-mvalsi.jpg', isFusion: true, fusionPartners: ['dansoz', 'dervis'] },
            { id: 'anka-kusu', name: 'Anka Kusu', description: 'Küllerinden yeniden doğuşun ve dizginlenemez ateşli gücün kutsal simgesi. O, gökyüzünde alevden kanatlarıyla süzülen, her bir tüyünden yaşam ve yıkım saçan, ilahi bir varlıktır.', star: 4, imageUrl: 'https://i.ibb.co/ch7vsRSp/anka.jpg', isFusion: true, fusionPartners: ['atesbuyucusu', 'kuskadin'] },
            { id: 'yuce-melek', name: 'Yüce Melek', description: 'İlahi yargının ve korkutucu huzurun tecessümü. Göksel kanatlarıyla adaleti yeryüzüne indiren, hem şefkatli bir koruyucu hem de amansız bir cezalandırıcı olan, göklerin kutsal habercisidir.', star: 4, imageUrl: 'https://i.ibb.co/sd5XfzyR/1753596990473.gif', isFusion: true, fusionPartners: ['kuskadin', 'rahibe'] },
            { id: 'kan-cicegi', name: 'Kan Çiçeği', description: 'Vampirin ölümsüz kanıyla sulanmış, Orman Ruhunun en nadide tohumundan filizlenmiş, hem cennet kadar güzel hem de cehennem kadar tehlikeli bir çiçektir. Kurbanlarını baştan çıkarıcı kokusuyla kendine çeker ve onları, köklerinin sonsuza dek besleneceği tatlı bir anıya dönüştürür.', star: 4, imageUrl: 'https://i.ibb.co/1f4kd5L1/kan.jpg', isFusion: true, fusionPartners: ['ormanruhu', 'vampir'] },
            { id: 'golem-efendisi', name: 'Golem Efendisi', description: 'Bir mekanigin yaratici dehasi ile bir illuzyonistin zihin kontrol gucu, bu komutanda birleşti. O, savas alanina kendi adim atmaz; onun yerine, ruhunu ve iradesini bahsettigi devasa golemi, bir kukla ustasinin zarafetiyle yonetir.', star: 4, imageUrl: 'https://i.ibb.co/m561FTzp/1753596929882.gif', isFusion: true, fusionPartners: ['illuzyonist', 'mekanik'] },
            { id: 'yildirim-elcisi', name: 'Yıldırım Elçisi', description: 'İzcinin topragin sirlarini bilen ayaklari ile Samanin gokyuzunun ofkesini cagiran sesi onda birleşti. O, firtinanin gelisini haber degil, firtinanin ta kendisi olan, doganin ilkel gucunun elcisidir.', star: 4, imageUrl: 'https://i.ibb.co/jkVbq1Gj/indir-29.jpg', isFusion: true, fusionPartners: ['izci', 'saman'] },
            { id: 'oluler-dusesi', name: 'Ölüler Düşesi', description: 'Bir vampirin olumsuz kaniyla muhurlenmis, en karanlik saman rituelerinin efendisidir. O, ruhlara sadece fisildamaz, onlara kanla hukumder ve mezarlarindan kaldirdigi sadik ordusuyla gecenin sessizligini bozar.', star: 4, imageUrl: 'https://i.ibb.co/Q3jDvRJd/merge-video-1753638876285.gif', isFusion: true, fusionPartners: ['saman', 'vampir'] },
            { id: 'meka-gladyator', name: 'Meka Gladyatör', description: 'Bir parali askerin sarsilmaz iradesi, bir mekanigin dahiyane zekasiyla birleştiginde, etle makinenin kusursuz bir uyumla dans ettigi bu durdurulamaz savasci dogdu. O, hem kendi bedeninin hem de dovustugu celigin mutlak efendisidir.', star: 4, imageUrl: 'https://i.ibb.co/wFpq0cLT/Efektli-Karakter-Videosu-Olu-turma.gif', isFusion: true, fusionPartners: ['mekanik', 'paraliasker'] },
            { id: 'dovus-kesisi', name: 'Dövüş Keşişi', description: 'O, ne bir dansci ne de sadece bir savasci; o, bedenini atalarinin savasci ruhlarina teslim eden, her adimi olumcul bir ritual olan bir saman. Dervisin durdurulamaz donusu, onun icin ruhlar alemine acilan bir kapidir.', star: 4, imageUrl: 'https://i.ibb.co/3yz8myZt/indir-33.jpg', isFusion: true, fusionPartners: ['dervis', 'saman'] },
        ]; 
        
        const characterGrid = document.getElementById('character-grid');
        const filterButtons = {
            oneStar: document.getElementById('show-1-star-btn'),
            twoStar: document.getElementById('show-2-star-btn'),
            threeStar: document.getElementById('show-3-star-btn'),
            fusion: document.getElementById('show-fusion-btn'),
            all: document.getElementById('show-all-btn'),
        };
        const characterModal = {
            element: document.getElementById('character-modal'),
            content: document.getElementById('character-modal-content'),
            name: document.getElementById('modal-character-name'),
            description: document.getElementById('modal-character-description'),
            evolutions: document.getElementById('modal-evolutions'),
            fusionsContainer: document.getElementById('modal-fusions'),
            fusionList: document.getElementById('fusion-list'),
            prevBtn: document.getElementById('prev-char-btn'),
            nextBtn: document.getElementById('next-char-btn'),
            prevName: document.getElementById('prev-char-name'),
            nextName: document.getElementById('next-char-name'),
        };
        const fusionModal = {
            element: document.getElementById('fusion-modal'),
            content: document.getElementById('fusion-modal-content'),
            name: document.getElementById('modal-fusion-name'),
            description: document.getElementById('modal-fusion-description'),
            image: document.getElementById('modal-fusion-image'),
            star: document.getElementById('modal-fusion-star'),
            leftChar: {
                image: document.getElementById('modal-fusion-left-char-image'),
                name: document.getElementById('modal-fusion-left-char-name'),
                starDisplay: document.getElementById('modal-fusion-left-char-star'), 
                container: document.getElementById('modal-fusion-left-char-image').parentElement
            },
            rightChar: {
                image: document.getElementById('modal-fusion-right-char-image'),
                name: document.getElementById('modal-fusion-right-char-name'),
                starDisplay: document.getElementById('modal-fusion-right-char-star'), 
                container: document.getElementById('modal-fusion-right-char-image').parentElement
            },
            prevBtn: document.getElementById('prev-fusion-btn'),
            nextBtn: document.getElementById('next-fusion-btn'),
            prevName: document.getElementById('prev-fusion-name'),
            nextName: document.getElementById('next-fusion-name'),
        };
        const enlargedImageOverlay = document.getElementById('enlarged-image-overlay');
        const enlargedImage = document.getElementById('enlarged-image');
        
        const zoomOutBtn = document.getElementById('zoom-out-btn');
        const zoomInBtn = document.getElementById('zoom-in-btn');
        const currentSizeLabel = document.getElementById('current-size-label');

        const fitToScreenToggleBtn = document.getElementById('fitToScreenToggleBtn'); 
        const columnsSliderContainer = document.getElementById('columns-slider-container');
        const columnCountSlider = document.getElementById('column-count-slider');
        const columnCountValue = document.getElementById('column-count-value');

        let galleryMode = 'all';
        let imageSizeIndex = 3; 
        let isFitToScreenMode = true; 
        let dynamicColumnCount = 4; 

        let currentModalCharId = null;
        let currentModalDisplayStar = null; 
        let currentModalType = null; 
        let uniqueNavigableList = [];

        let sizeProfiles = [
            { name: '1', minCardWidth: '160px', maxCardWidth: '180px', baseColumnCount: 2, evolutionBox: 'w-56 h-auto', fusionThumb: 'w-40 h-auto', fusionPartner: 'w-64 h-auto', fusionMainMaxH: 'max-h-96' },
            { name: '2', minCardWidth: '200px', maxCardWidth: '220px', baseColumnCount: 2, evolutionBox: 'w-64 h-auto', fusionThumb: 'w-44 h-auto', fusionPartner: 'w-72 h-auto', fusionMainMaxH: 'max-h-[28rem]' },
            { name: '3', minCardWidth: '240px', maxCardWidth: '260px', baseColumnCount: 3, evolutionBox: 'w-72 h-auto', fusionThumb: 'w-48 h-auto', fusionPartner: 'w-80 h-auto', fusionMainMaxH: 'max-h-[32rem]' },
            { name: '4', minCardWidth: '280px', maxCardWidth: '300px', baseColumnCount: 4, evolutionBox: 'w-80 h-auto', fusionThumb: 'w-56 h-auto', fusionPartner: 'w-96 h-auto', fusionMainMaxH: 'max-h-[36rem]' },
            { name: '5', minCardWidth: '320px', maxCardWidth: '340px', baseColumnCount: 5, evolutionBox: 'w-96 h-auto', fusionThumb: 'w-64 h-auto', fusionPartner: 'w-[28rem] h-auto', fusionMainMaxH: 'max-h-[40rem]' }
        ];

        function getStarEmojis(starCount, applyGlow = false) { 
            const colors = { 
                1: 'text-orange-400', 
                2: 'text-gray-400', 
                3: 'text-yellow-400', 
                4: FUSION_STAR_COLOR_CLASS 
            };
            const glowClass = applyGlow ? 'glow-text-purple-animated' : ''; 
            return Array(starCount).fill(`<span class="${colors[starCount]} text-2xl ${glowClass}">★</span>`).join('');
        }

        function getCharacterImageUrlByStar(baseCharId, star) {
            const baseChar = characters.find(c => c.id === baseCharId && !c.isFusion);
            if (!baseChar) return '';
            if (star === 1) return baseChar.imageUrl;
            const evolution = baseChar.evolutions.find(e => e.star === star);
            return evolution ? evolution.imageUrl : '';
        }

        function get3StarImageUrl(baseCharId) {
            const baseChar = characters.find(c => c.id === baseCharId && !c.isFusion);
            if (!baseChar) return '';
            const threeStarEvo = baseChar.evolutions.find(e => e.star === 3);
            return threeStarEvo ? threeStarEvo.imageUrl : '';
        }

        function renderCharacters() {
            characterGrid.innerHTML = '';
            
            if (isFitToScreenMode) {
                characterGrid.style.setProperty('--grid-min-card-width', '0'); 
                characterGrid.style.setProperty('--grid-max-card-width', '1fr'); 
                characterGrid.style.gridTemplateColumns = `repeat(${dynamicColumnCount}, minmax(0, 1fr))`;
            } else {
                characterGrid.style.setProperty('--grid-min-card-width', sizeProfiles[imageSizeIndex].minCardWidth);
                characterGrid.style.setProperty('--grid-max-card-width', sizeProfiles[imageSizeIndex].maxCardWidth);
                characterGrid.style.gridTemplateColumns = `repeat(auto-fit, minmax(var(--grid-min-card-width), var(--grid-max-card-width)))`;
            }

            let allDisplayableCharacters = [];
            let currentUniqueNavigableList = [];

            if (galleryMode === 'fusion') {
                allDisplayableCharacters = characters.filter(char => char.isFusion);
            } else if (galleryMode === 'all') {
                characters.forEach(char => {
                    if (!char.isFusion) { 
                        allDisplayableCharacters.push({ ...char, displayStar: 1, displayImageUrl: char.imageUrl }); 
                        if (char.evolutions) {
                            char.evolutions.forEach(evo => {
                                allDisplayableCharacters.push({ ...char, displayStar: evo.star, displayImageUrl: evo.imageUrl }); 
                            });
                        }
                    } 
                });
                allDisplayableCharacters = allDisplayableCharacters.concat(characters.filter(char => char.isFusion).map(char => ({...char, displayStar: 4, displayImageUrl: char.imageUrl})));

            } else { 
                allDisplayableCharacters = characters.filter(char => !char.isFusion && char.star === 1).flatMap(char => {
                    if (galleryMode === '1-star') {
                        return [{ ...char, displayStar: 1, displayImageUrl: char.imageUrl }];
                    } else if (galleryMode === '2-star') {
                        const evo2 = char.evolutions.find(e => e.star === 2);
                        return evo2 ? [{ ...char, displayStar: 2, displayImageUrl: evo2.imageUrl }] : [];
                    } else if (galleryMode === '3-star') {
                        const evo3 = char.evolutions.find(e => e.star === 3);
                        return evo3 ? [{ ...char, displayStar: 3, displayImageUrl: evo3.imageUrl }] : [];
                    }
                    return [];
                });
            }
            
            allDisplayableCharacters.sort((a, b) => {
                if (!a.isFusion && b.isFusion) return -1;
                if (a.isFusion && !b.isFusion) return 1;
                const nameCompare = a.name.localeCompare(b.name);
                if (nameCompare !== 0) return nameCompare;
                return a.displayStar - b.displayStar;
            });

            currentUniqueNavigableList = [];
            const processedBaseCharIds = new Set();
            characters.forEach(char => {
                if (!char.isFusion && !processedBaseCharIds.has(char.id)) {
                    currentUniqueNavigableList.push({ ...char, displayStar: 1 });
                    processedBaseCharIds.add(char.id);
                } else if (char.isFusion) {
                    currentUniqueNavigableList.push(char);
                }
            });

            currentUniqueNavigableList.sort((a, b) => {
                if (!a.isFusion && b.isFusion) return -1;
                if (a.isFusion && !b.isFusion) return 1;
                return a.name.localeCompare(b.name);
            });

            uniqueNavigableList = currentUniqueNavigableList;

            if (allDisplayableCharacters.length === 0) {
                characterGrid.innerHTML = '<p class="col-span-full text-center text-gray-400 text-lg">Gösterilecek karakter bulunamadı.</p>';
                return;
            }

            allDisplayableCharacters.forEach(char => {
                const card = document.createElement('div');
                let borderColor = 'border-indigo-500'; 
                let starCountToDisplay = char.displayStar || char.star; 
                let glowClassForCard = ''; 
                
                if (char.isFusion) {
                    borderColor = 'border-purple-500'; 
                    glowClassForCard = 'glow-purple'; 
                } else if (starCountToDisplay === 2) {
                    borderColor = 'border-gray-500';
                } else if (starCountToDisplay === 3) {
                    borderColor = 'border-yellow-500';
                } else if (starCountToDisplay === 1) { 
                     borderColor = 'border-orange-400';
                }

                const nameClass = char.isFusion ? 'font-fusion' : '';
                let imageUrlToDisplay = char.displayImageUrl || char.imageUrl; 

                card.className = `relative rounded-xl shadow-lg p-4 flex flex-col items-center justify-between cursor-pointer transform hover:scale-105 transition duration-300 ease-in-out border-b-4 ${borderColor} ${glowClassForCard}`;
                card.style.backgroundColor = char.isFusion ? FUSION_BACKGROUND_COLOR : '#4a5568';
                card.dataset.id = char.id;
                
                card.onclick = () => {
                    if (char.isFusion) {
                        openFusionModal(char.id, 4);
                    } else {
                        openCharacterModal(char.id, 1);
                    }
                };

                const starsHtml = getStarEmojis(starCountToDisplay, char.isFusion); 

                card.innerHTML = `
                    <img src="${imageUrlToDisplay}" alt="${char.name}" class="character-card-image rounded-lg mb-3 shadow-sm" loading="lazy" onerror="this.onerror=null;this.src=https://placehold.co/300x400/CCCCCC/000000?text=Resim+Yok;">
                    <h3 class="text-xl font-semibold text-gray-100 mb-1 text-center character-name-ellipsis ${nameClass}">${char.name}</h3>
                    <div class="flex">${starsHtml}</div>
                `;
                characterGrid.appendChild(card);
            });
            updateFilterButtons();
        }

        function updateFilterButtons() {
            Object.entries(filterButtons).forEach(([key, button]) => {
                const modeMap = { oneStar: '1-star', twoStar: '2-star', threeStar: '3-star', fusion: 'fusion', all: 'all' };
                if (galleryMode === modeMap[key]) {
                    button.classList.add('bg-indigo-600', 'text-white');
                    button.classList.remove('bg-gray-700', 'text-gray-200');
                } else {
                    button.classList.remove('bg-indigo-600', 'text-white');
                    button.classList.add('bg-gray-700', 'text-gray-200');
                }
            });
        }
        
        function updateZoomControls() {
            currentSizeLabel.textContent = sizeProfiles[imageSizeIndex].name;
            zoomOutBtn.disabled = imageSizeIndex === 0;
            zoomInBtn.disabled = imageSizeIndex === sizeProfiles.length - 1;
        }

        Object.entries(filterButtons).forEach(([key, button]) => {
            const modeMap = { oneStar: '1-star', twoStar: '2-star', threeStar: '3-star', fusion: 'fusion', all: 'all' };
            button.addEventListener('click', () => {
                galleryMode = modeMap[key];
                renderCharacters();
            });
        });
        
        zoomInBtn.addEventListener('click', () => {
            if (imageSizeIndex < sizeProfiles.length - 1) {
                imageSizeIndex++;
                updateZoomControls();
                renderCharacters();
            }
        });

        zoomOutBtn.addEventListener('click', () => {
            if (imageSizeIndex > 0) {
                imageSizeIndex--;
                updateZoomControls();
                renderCharacters();
            }
        });

        function openModal(modalElement, contentElement) {
            modalElement.classList.remove('hidden');
            setTimeout(() => contentElement.classList.remove('scale-95', 'opacity-0'), 50);
        }

        function closeModal(modalElement, contentElement) {
            contentElement.classList.add('scale-95', 'opacity-0');
            setTimeout(() => modalElement.classList.add('hidden'), 300);
            currentModalCharId = null; 
            currentModalDisplayStar = null; 
            currentModalType = null;
        }

        function updateModalNavigation(id, type, displayStarAtClick) {
            currentModalCharId = id;
            currentModalType = type;
            currentModalDisplayStar = displayStarAtClick; 

            const listToNavigate = uniqueNavigableList;
            const currentIndex = listToNavigate.findIndex(item => item.id === id); 

            const prevItem = currentIndex > 0 ? listToNavigate[currentIndex - 1] : null;
            const nextItem = currentIndex < listToNavigate.length - 1 ? listToNavigate[currentIndex + 1] : null;

            const modalInfo = type === 'character' ? characterModal : fusionModal;
            
            const openNextOrPrev = (item) => {
                if (item.isFusion) { openFusionModal(item.id, 4); } 
                else { openCharacterModal(item.id, 1); }
            };

            const closeFunc = type === 'character' ? closeCharacterModal : closeFusionModal;
            
            // Önceki Buton ve İsim
            if (prevItem) {
                const prevAction = (e) => {
                    e.stopPropagation();
                    closeFunc();
                    setTimeout(() => openNextOrPrev(prevItem), 300); 
                };
                modalInfo.prevBtn.disabled = false;
                modalInfo.prevName.textContent = prevItem.name;
                modalInfo.prevBtn.onclick = prevAction;
                // DEĞİŞİKLİK: Önceki ismini tıklanabilir yap
                modalInfo.prevName.onclick = prevAction;
                modalInfo.prevName.style.cursor = 'pointer';
            } else {
                modalInfo.prevBtn.disabled = true;
                modalInfo.prevName.textContent = 'Yok';
                modalInfo.prevBtn.onclick = null;
                 // DEĞİŞİKLİK: Tıklama özelliğini kaldır
                modalInfo.prevName.onclick = null;
                modalInfo.prevName.style.cursor = 'default';
            }

            // Sonraki Buton ve İsim
            if (nextItem) {
                const nextAction = (e) => {
                    e.stopPropagation();
                    closeFunc();
                    setTimeout(() => openNextOrPrev(nextItem), 300);
                };
                modalInfo.nextBtn.disabled = false;
                modalInfo.nextName.textContent = nextItem.name;
                modalInfo.nextBtn.onclick = nextAction;
                // DEĞİŞİKLİK: Sonraki ismini tıklanabilir yap
                modalInfo.nextName.onclick = nextAction;
                modalInfo.nextName.style.cursor = 'pointer';
            } else {
                modalInfo.nextBtn.disabled = true;
                modalInfo.nextName.textContent = 'Yok';
                modalInfo.nextBtn.onclick = null;
                // DEĞİŞİKLİK: Tıklama özelliğini kaldır
                modalInfo.nextName.onclick = null;
                modalInfo.nextName.style.cursor = 'default';
            }
        }

        function openCharacterModal(characterId, displayStarAtClick) {
            const clickedChar = characters.find(c => c.id === characterId && !c.isFusion);
            if (!clickedChar) return; 

            characterModal.name.textContent = clickedChar.name;
            characterModal.description.textContent = clickedChar.description;
            characterModal.evolutions.innerHTML = '';
            
            const currentSize = sizeProfiles[imageSizeIndex];
            const evolutionImageBaseClass = `w-full h-auto object-contain rounded-lg mb-2 cursor-zoom-in`;
            const evolutionBoxClass = currentSize.evolutionBox;
            const allEvolutions = [{ star: 1, imageUrl: clickedChar.imageUrl, id: clickedChar.id }, ...(clickedChar.evolutions || [])];

            allEvolutions.forEach(evo => {
                const evoDiv = document.createElement('div');
                evoDiv.className = `flex flex-col items-center p-3 bg-gray-600 rounded-lg shadow-sm ${evolutionBoxClass}`;
                const imageUrl = getCharacterImageUrlByStar(clickedChar.id, evo.star);
                evoDiv.innerHTML = `
                    <img src="${imageUrl}" alt="${clickedChar.name} ${evo.star} Yıldız" class="${evolutionImageBaseClass}" onclick="enlargeImage(this.src)" onerror="this.onerror=null;this.src=https://placehold.co/300x400/CCCCCC/000000?text=Resim+Yok;">
                    <p class="text-lg font-medium text-gray-200">${getStarEmojis(evo.star)}</p>
                `;
                characterModal.evolutions.appendChild(evoDiv);
            });

            characterModal.fusionList.innerHTML = '';
            const fusionsOfThisCharacter = characters.filter(fusion => 
                fusion.isFusion && fusion.fusionPartners && fusion.fusionPartners.includes(clickedChar.id)
            );

            if (fusionsOfThisCharacter.length > 0) {
                characterModal.fusionsContainer.classList.remove('hidden');
                fusionsOfThisCharacter.forEach(fusionChar => {
                    const fusionCard = document.createElement('div');
                    fusionCard.className = `rounded-lg shadow-md p-3 flex flex-col items-center cursor-pointer hover:opacity-80 transition duration-200 ${'glow-purple'}`; 
                    fusionCard.style.backgroundColor = FUSION_BACKGROUND_COLOR; 
                    fusionCard.onclick = (e) => { e.stopPropagation(); closeCharacterModal(); openFusionModal(fusionChar.id, 4); };
                    const fusionThumbImageClass = `${currentSize.fusionThumb} object-cover rounded-lg mb-2 border-2 border-purple-400`;
                    fusionCard.innerHTML = `
                        <img src="${fusionChar.imageUrl}" alt="${fusionChar.name}" class="${fusionThumbImageClass} ${'glow-purple'}" onerror="this.onerror=null;this.src=https://placehold.co/150x150/CCCCCC/000000?text=Resim+Yok;">
                        <p class="text-md font-semibold text-gray-200 text-center font-fusion">${fusionChar.name}</p>
                    `;
                    characterModal.fusionList.appendChild(fusionCard);
                });
            } else {
                characterModal.fusionsContainer.classList.add('hidden');
            }

            openModal(characterModal.element, characterModal.content);
            updateModalNavigation(characterId, 'character', displayStarAtClick); 
        }

        function closeCharacterModal() { closeModal(characterModal.element, characterModal.content); }

        function openFusionModal(fusionId, displayStarAtClick) {
            const fusionChar = characters.find(c => c.id === fusionId && c.isFusion);
            if (!fusionChar) return;
            
            const currentSize = sizeProfiles[imageSizeIndex];
            fusionModal.name.textContent = fusionChar.name;
            fusionModal.name.classList.add('font-fusion');
            fusionModal.description.textContent = fusionChar.description;
            fusionModal.image.src = fusionChar.imageUrl;
            fusionModal.image.alt = fusionChar.name;
            const fusionMainImageClass = `w-full h-auto object-contain rounded-lg shadow-md cursor-zoom-in ${currentSize.fusionMainMaxH}`;
            const fusionPartnerImageClass = `${currentSize.fusionPartner} object-contain rounded-lg border-4 border-indigo-500 shadow-md`;
            fusionModal.image.className = `${fusionMainImageClass} ${'glow-purple'}`;
            fusionModal.content.style.backgroundColor = FUSION_BACKGROUND_COLOR; 
            fusionModal.content.classList.add('fusion-modal-background-glow');
            const [partner1BaseId, partner2BaseId] = fusionChar.fusionPartners;
            const partner1BaseChar = characters.find(c => c.id === partner1BaseId && !c.isFusion);
            const partner2BaseChar = characters.find(c => c.id === partner2BaseId && !c.isFusion);

            if (partner1BaseChar) {
                const partner1ThreeStarImage = get3StarImageUrl(partner1BaseChar.id); 
                fusionModal.leftChar.image.src = partner1ThreeStarImage;
                fusionModal.leftChar.image.className = `${fusionPartnerImageClass} ${'glow-purple'}`; 
                fusionModal.leftChar.name.textContent = partner1BaseChar.name;
                fusionModal.leftChar.container.dataset.characterId = partner1BaseChar.id;
                fusionModal.leftChar.starDisplay.innerHTML = `<span class="text-lg font-medium ${THREE_STAR_COLOR_CLASS}">★★★</span>`; 
            }
             if (partner2BaseChar) {
                const partner2ThreeStarImage = get3StarImageUrl(partner2BaseChar.id); 
                fusionModal.rightChar.image.src = partner2ThreeStarImage;
                fusionModal.rightChar.image.className = `${fusionPartnerImageClass} ${'glow-purple'}`; 
                fusionModal.rightChar.name.textContent = partner2BaseChar.name;
                fusionModal.rightChar.container.dataset.characterId = partner2BaseChar.id;
                fusionModal.rightChar.starDisplay.innerHTML = `<span class="text-lg font-medium ${THREE_STAR_COLOR_CLASS}">★★★</span>`; 
            }

            fusionModal.star.innerHTML = `<span class="text-3xl ${FUSION_STAR_COLOR_CLASS} ${'glow-text-purple-animated'}">★★★★</span>`; 
            openModal(fusionModal.element, fusionModal.content);
            updateModalNavigation(fusionId, 'fusion', displayStarAtClick); 
        }

        function closeFusionModal() {
            fusionModal.name.classList.remove('font-fusion');
            fusionModal.content.classList.remove('fusion-modal-background-glow');
            closeModal(fusionModal.element, fusionModal.content);
        }

        function enlargeImage(src) {
            enlargedImage.src = src;
            enlargedImageOverlay.classList.remove('hidden');
        }

        function closeEnlargedImage(event) {
            if (event) event.stopPropagation();
            enlargedImageOverlay.classList.add('hidden');
        }

        fitToScreenToggleBtn.addEventListener('click', () => {
            isFitToScreenMode = !isFitToScreenMode; 
            if (isFitToScreenMode) {
                fitToScreenToggleBtn.classList.add('active'); 
                const tempCard = document.createElement('div');
                tempCard.style.width = sizeProfiles[imageSizeIndex].maxCardWidth; 
                tempCard.style.visibility = 'hidden';
                tempCard.style.position = 'absolute';
                characterGrid.appendChild(tempCard);
                const cardWidthPx = tempCard.offsetWidth;
                characterGrid.removeChild(tempCard); 
                const gridContainerWidth = characterGrid.offsetWidth;
                const gapWidth = 24;
                let estimatedBaseCols = Math.floor((gridContainerWidth + gapWidth) / (cardWidthPx + gapWidth));
                estimatedBaseCols = Math.max(1, estimatedBaseCols);
                const minSliderValue = Math.max(2, Math.ceil(estimatedBaseCols * 1.5));
                const maxSliderValue = Math.max(minSliderValue, estimatedBaseCols * 2);
                columnCountSlider.min = Math.max(2, minSliderValue);
                columnCountSlider.max = Math.max(3, maxSliderValue);
                columnCountSlider.value = columnCountSlider.min;
                dynamicColumnCount = parseInt(columnCountSlider.value);
                columnCountValue.textContent = dynamicColumnCount;
            } else {
                fitToScreenToggleBtn.classList.remove('active'); 
            }
            renderCharacters(); 
        });

        columnCountSlider.addEventListener('input', () => {
            dynamicColumnCount = columnCountSlider.value;
            columnCountValue.textContent = dynamicColumnCount;
            renderCharacters(); 
        });


        window.onload = () => {
            if (isFitToScreenMode) {
                fitToScreenToggleBtn.classList.add('active');
            } else {
                fitToScreenToggleBtn.classList.remove('active');
            }

            const tempCard = document.createElement('div');
            tempCard.style.width = sizeProfiles[imageSizeIndex].maxCardWidth; 
            tempCard.style.visibility = 'hidden';
            tempCard.style.position = 'absolute';
            characterGrid.appendChild(tempCard);
            const cardWidthPx = tempCard.offsetWidth;
            characterGrid.removeChild(tempCard);
            const gridContainerWidth = characterGrid.offsetWidth;
            const gapWidth = 24;
            let estimatedBaseCols = Math.floor((gridContainerWidth + gapWidth) / (cardWidthPx + gapWidth));
            estimatedBaseCols = Math.max(1, estimatedBaseCols);
            const minSliderValue = Math.max(2, Math.ceil(estimatedBaseCols * 1.5));
            const maxSliderValue = Math.max(minSliderValue, estimatedBaseCols * 2);
            columnCountSlider.min = Math.max(2, minSliderValue);
            columnCountSlider.max = Math.max(3, maxSliderValue);
            columnCountSlider.value = columnCountSlider.min;
            dynamicColumnCount = parseInt(columnCountSlider.value);
            columnCountValue.textContent = dynamicColumnCount;
            
            updateZoomControls(); 
            renderCharacters(); 
        };

    </script>
</body>
</html>
